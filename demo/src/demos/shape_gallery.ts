// Shape Gallery demo — real-world polygon datasets from the poly2tri/tess2.js ecosystem
import { tessellate, WINDING_RULES, WindingRule } from '../wasm.ts';
import { makeCanvas, drawTessellation, COLORS } from '../render-canvas.ts';
import { persistControls } from '../state.ts';

interface GalleryShape {
  name: string;
  description: string;
  contours: number[][];
  reversed?: boolean[];
}

const SHAPES: GalleryShape[] = [
  {
    name: 'Spiral',
    description: 'A smooth spiral curve from Berkeley CS 274 tests — 15 vertices.',
    contours: [[0,0, -0.416,0.909, -1.35,0.436, -1.64,-0.549, -1.31,-1.51, -0.532,-2.17, 0.454,-2.41, 1.45,-2.21, 2.29,-1.66, 2.88,-0.838, 3.16,0.131, 3.12,1.14, 2.77,2.08, 2.16,2.89, 1.36,3.49]],
  },
  {
    name: 'Diamond',
    description: 'A wide diamond shape with collinear edges — tests sweep-line handling of degenerate angles.',
    contours: [[0,0, 2,1, 4,2, 6,3, 8,4, 1,5, -8,4, -6,3, -4,2, -2,1]],
  },
  {
    name: 'Star (tess2.js)',
    description: 'A star polygon from the poly2tri testbed — integer coordinates at screen scale.',
    contours: [[350,75, 379,161, 469,161, 397,215, 423,301, 350,250, 277,301, 303,215, 231,161, 321,161]],
  },
  {
    name: 'Dude',
    description: 'A humanoid figure with 94 vertices — one of the classic poly2tri test shapes.',
    contours: [[280.35714,648.79075, 286.78571,662.8979, 263.28607,661.17871, 262.31092,671.41548, 250.53571,677.00504, 250.53571,683.43361, 256.42857,685.21933, 297.14286,669.50504, 289.28571,649.50504, 285,631.6479, 285,608.79075, 292.85714,585.21932, 306.42857,563.79075, 323.57143,548.79075, 339.28571,545.21932, 357.85714,547.36218, 375,550.21932, 391.42857,568.07647, 404.28571,588.79075, 413.57143,612.36218, 417.14286,628.07647, 438.57143,619.1479, 438.03572,618.96932, 437.5,609.50504, 426.96429,609.86218, 424.64286,615.57647, 419.82143,615.04075, 420.35714,605.04075, 428.39286,598.43361, 437.85714,599.68361, 443.57143,613.79075, 450.71429,610.21933, 431.42857,575.21932, 405.71429,550.21932, 372.85714,534.50504, 349.28571,531.6479, 346.42857,521.6479, 346.42857,511.6479, 350.71429,496.6479, 367.85714,476.6479, 377.14286,460.93361, 385.71429,445.21932, 388.57143,404.50504, 360,352.36218, 337.14286,325.93361, 330.71429,334.50504, 347.14286,354.50504, 337.85714,370.21932, 333.57143,359.50504, 319.28571,353.07647, 312.85714,366.6479, 350.71429,387.36218, 368.57143,408.07647, 375.71429,431.6479, 372.14286,454.50504, 366.42857,462.36218, 352.85714,462.36218, 336.42857,456.6479, 332.85714,438.79075, 338.57143,423.79075, 338.57143,411.6479, 327.85714,405.93361, 320.71429,407.36218, 315.71429,423.07647, 314.28571,440.21932, 325,447.71932, 324.82143,460.93361, 317.85714,470.57647, 304.28571,483.79075, 287.14286,491.29075, 263.03571,498.61218, 251.60714,503.07647, 251.25,533.61218, 260.71429,533.61218, 272.85714,528.43361, 286.07143,518.61218, 297.32143,508.25504, 297.85714,507.36218, 298.39286,506.46932, 307.14286,496.6479, 312.67857,491.6479, 317.32143,503.07647, 322.5,514.1479, 325.53571,521.11218, 327.14286,525.75504, 326.96429,535.04075, 311.78571,540.04075, 291.07143,552.71932, 274.82143,568.43361, 259.10714,592.8979, 254.28571,604.50504, 251.07143,621.11218, 250.53571,649.1479, 268.1955,654.36208]],
  },
  {
    name: 'Tank',
    description: 'A tank silhouette with 55 vertices — detailed vehicle outline from poly2tri.',
    contours: [[-37.317758,260.65677, -37.317758,317.44301, -34.741139,339.73612, -27.330761,354.21222, 59.525828,406.25724, 444.17643,404.87856, 538.9604,368.68832, 555.15984,355.59089, 558.95121,344.90615, 559.64054,325.94936, 568.19908,315.85885, 572.586,322.56108, 584.65003,322.31737, 568.80837,296.11771, 557.59736,289.78104, 539.56224,286.49085, 443.31476,286.82943, 389.89106,280.79772, 405.74583,272.00866, 412.98388,262.01326, 475.5413,262.1856, 480.71134,267.01096, 514.66123,266.66629, 520.34827,262.01326, 669.93463,262.01326, 670.45162,264.08127, 676.91417,263.82277, 678.03434,262.09943, 680.61936,261.66859, 683.03204,255.46455, 682.51504,249.94985, 677.862,243.91814, 668.81445,243.4873, 665.28159,247.02016, 520.86527,246.33082, 514.66123,240.12678, 479.67733,239.95444, 475.5413,243.57347, 412.98388,243.05647, 397.64611,227.54636, 324.74862,221.16998, 323.88695,214.79361, 328.36764,211.86392, 326.6443,207.03856, 300.79412,207.03856, 295.62409,211.69159, 285.28402,208.2449, 272.01426,211.17458, 96.577738,209.62357, 80.205961,211.86392, 58.491817,232.7164, 74.863594,254.94755, 168.61356,269.25131, 175.16228,276.83403, 87.271676,260.11758]],
  },
  {
    name: 'Funny',
    description: 'An organic amoeba-like shape with 100 vertices — tests complex curvature.',
    contours: [[100.317505,0.0, 146.29202,9.203914, 129.52948,16.363379, 95.36635,18.192104, 88.769775,22.792204, 102.68762,33.36523, 142.4203,56.388184, 132.23712,62.22607, 134.04555,73.69216, 121.24752,76.946014, 140.18803,101.85256, 124.024445,102.601944, 119.727,112.43114, 144.82764,154.22577, 155.76044,188.28203, 146.94632,202.25424, 133.9567,211.08199, 120.438416,219.07668, 103.53854,220.03061, 90.72225,229.13826, 77.25425,237.76413, 54.851055,213.63075, 46.84533,245.57181, 31.33331,248.02867, 15.69763,249.50668, 0.0,250.0, -13.490268,214.42166, -29.863472,236.39372, -44.794296,234.81993, -50.172047,195.40721, -69.351425,213.44174, -75.72414,191.25734, -96.03964,204.09464, -120.438416,219.07668, -127.11785,200.30568, -119.31813,164.22733, -130.35721,157.57478, -112.00853,119.27697, -142.68515,133.99026, -117.65654,97.333954, -125.62218,91.26986, -114.24053,72.499245, -160.95981,88.4884, -138.49583,65.171196, -102.99021,40.776707, -141.48434,45.97105, -97.90232,25.137043, -116.9116,22.30208, -145.58727,18.391949, -183.83247,11.565759, -190.12851,0.0, -157.68095,-9.9204445, -186.18002,-23.520008, -160.72182,-30.659325, -143.63857,-36.880116, -143.12222,-46.50323, -98.59685,-39.037254, -86.89141,-40.887993, -83.81993,-46.0804, -42.216396,-26.79134, -40.45085,-29.389263, -38.52566,-31.871199, -46.53258,-43.697002, -34.227356,-36.448433, -38.017994,-45.95586, -29.389263,-40.45085, -26.79134,-42.216396, -31.430187,-57.1713, -22.040213,-46.837833, -27.75829,-70.109436, -26.90105,-82.79292, -13.713537,-53.4107, -10.41509,-54.59781, -6.2666616,-49.605736, -3.139526,-49.901337, 0.0,-50.0, 3.5057213,-55.721844, 6.2666616,-49.605736, 14.274147,-74.8277, 19.75647,-76.946365, 24.69724,-76.01029, 24.807446,-62.656456, 28.282286,-60.102917, 37.102608,-67.489395, 51.878616,-81.74762, 46.092445,-63.440807, 34.334026,-41.502712, 34.227356,-36.448433, 43.65427,-40.99409, 38.52566,-31.871199, 40.45085,-29.389263, 42.216396,-26.79134, 52.668476,-28.95474, 86.38597,-40.650154, 126.91717,-50.25006, 83.21832,-27.039272, 109.77473,-28.185358, 105.45997,-20.117565, 119.66038,-15.116621, 74.30321,-4.674762]],
  },
  {
    name: 'GLU Winding',
    description: 'Classic SGI GLU tessellator test — multiple contours with various winding patterns. Try different winding rules to see the effect.',
    contours: [
      [0,0, 6,0, 6,6, 0,6],
      [1,1, 5,1, 5,5, 1,5],
      [2,2, 4,2, 4,4, 2,4],
      [10,0, 16,0, 16,6, 10,6],
      [11,1, 11,5, 15,5, 15,1],
      [12,2, 12,4, 14,4, 14,2],
      [21,1, 25,1, 25,6, 21,6],
      [20,2, 26,2, 26,3, 20,3],
      [22,5, 23,0, 24,5],
      [33,3, 33,2, 34,2, 34,4, 32,4, 32,1, 35,1, 35,5, 31,5, 31,0, 36,0, 36,6, 30,6, 30,-1, 37,-1, 37,3],
    ],
  },
  {
    name: 'GLU Example',
    description: 'The classic SGI GLU example — a square with a triangular notch plus a self-intersecting star polygon.',
    contours: [
      [50,50, 200,50, 200,200, 50,200],
      [75,75, 125,175, 175,75],
      [250,50, 325,200, 400,50, 250,150, 400,150],
    ],
  },
  {
    name: 'Butterfly (Debug)',
    description: 'A complex butterfly-like shape with 198 data points — from the poly2tri debug dataset.',
    contours: [[1.2277408,0.0, 1.3243141,0.041618247, 1.0635862,0.06691518, 0.952708,0.09005742, 0.9624486,0.12158553, 1.3459457,0.21317686, 0.94439876,0.1801537, 0.58555007,0.13088594, 0.5811499,0.14921393, 0.82454175,0.23955151, 0.62284756,0.20237544, 0.56452847,0.20324275, 0.5578659,0.22087473, 0.6222525,0.2692727, 0.5428962,0.25546756, 0.6560448,0.33427152, 0.525784,0.28905222, 0.71199375,0.42107195, 0.8918749,0.56600106, 0.93826324,0.63764304, 0.5041431,0.36628145, 0.74085724,0.57466775, 0.55901116,0.46245426, 0.45006666,0.3967871, 0.43738118,0.41072828, 0.42426407,0.42426407, 0.41072828,0.43738118, 0.3967871,0.45006666, 0.41002733,0.4956379, 0.7536917,0.9716534, 1.0196112,1.4033744, 0.66767913,0.98246, 0.7202045,1.1348608, 0.44231245,0.7479095, 0.28905222,0.525784, 0.2723943,0.5346039, 0.5011288,1.0649529, 0.27308202,0.6310553, 0.22087473,0.5578659, 0.20460863,0.56832236, 0.3397839,1.0457473, 0.26354295,0.9071208, 0.2884009,1.1232473, 0.15593462,0.69761133, 0.16937841,0.88791275, 0.21818724,1.37758, 0.1523747,1.20617, 0.11806885,1.249038, 0.06135568,0.97522056, 0.018846456,0.5997039, 0.0,1.113445, -0.028901286,0.91965383, -0.06209223,0.98692775, -0.05646499,0.5973372, -0.10701424,0.84710497, -0.09386068,0.592613, -0.1636339,0.8577989, -0.29984477,1.3414284, -0.45487383,1.7716166, -0.6387838,2.1987083, -0.6129905,1.8865908, -0.8446652,2.3461478, -0.9281012,2.344116, -1.0037318,2.3194876, -1.0196298,2.1668236, -0.8902802,1.7472732, -1.2330354,2.242883, -1.4297054,2.4174998, -1.6074804,2.5329838, -1.4688258,2.1613116, -1.7633557,2.427051, -1.6571896,2.136436, -1.912272,2.3115396, -1.6086806,1.82469, -1.6045313,1.7086523, -2.0598311,2.0598311, -1.8296968,1.7181997, -2.2503333,1.9839356, -2.1353924,1.7665502, -2.370465,1.8387212, -2.427051,1.7633557, -2.4812417,1.6862501, -2.5329838,1.6074804, -2.5773842,1.5242608, -2.62892,1.445261, -2.6730196,1.3619715, -2.714481,1.2773379, -2.753264,1.1914437, -2.7893295,1.1043737, -2.8226423,1.0162138, -2.8531694,0.927051, -2.5261154,0.73390436, -2.6257684,0.6741827, -2.9277503,0.65442973, -2.8118498,0.53638905, -2.963065,0.4693034, -2.976344,0.3759997, -2.617039,0.24738303, -2.99408,0.18837155, -2.860681,0.08990052, -3.0,0.0, -2.6968896,-0.08475317, -2.99408,-0.18837155, -2.431072,-0.22980396, -2.4993353,-0.31573948, -2.3772683,-0.3765223, -2.523671,-0.48141596, -2.4523084,-0.54815584, -1.9428126,-0.49882948, -1.980212,-0.57530475, -1.6508379,-0.53638977, -1.7593161,-0.63339275, -1.1899233,-0.47112396, -0.8138197,-0.35217124, -0.5630522,-0.26495224, -0.5346039,-0.2723943, -0.878033,-0.4827027, -0.85542375,-0.5058962, -1.2059882,-0.76534337, -0.97923774,-0.66548926, -1.0108875,-0.7344528, -0.7830176,-0.6073707, -0.90356225,-0.74749166, -1.0288435,-0.90704757, -1.1261301,-1.0575066, -0.9001703,-0.9001703, -0.8477716,-0.902785, -0.5851195,-0.66368777, -0.47532755,-0.5745723, -0.6310177,-0.8135031, -0.40265256,-0.5542037, -0.33725002,-0.49624833, -0.32149607,-0.50659674, -0.46425027,-0.7850044, -0.38156003,-0.69405514, -0.2723943,-0.5346039, -0.25546756,-0.5428962, -0.23828873,-0.5506528, -0.22087473,-0.5578659, -0.20324275,-0.56452847, -0.20844458,-0.64152646, -0.16739467,-0.5761762, -0.14921393,-0.5811499, -0.13088594,-0.58555007, -0.14249685,-0.7469947, -0.11622784,-0.73383373, -0.081517614,-0.64527833, -0.07004014,-0.7409472, -0.05557717,-0.88337386, -0.025127873,-0.7995819, 0.0,-0.6, 0.029305225,-0.9325074, 0.05083992,-0.8080774, 0.10585039,-1.1197802, 0.18259653,-1.4454004, 0.21030101,-1.3277884, 0.17551,-0.9200556, 0.17963327,-0.8036331, 0.14921393,-0.5811499, 0.26661414,-0.9176919, 0.1854102,-0.5706339, 0.24760589,-0.6877518, 0.251998,-0.6364744, 0.23828873,-0.5506528, 0.4822611,-1.024857, 0.479923,-0.9419019, 0.34421936,-0.62613267, 0.55215293,-0.9336396, 0.70164776,-1.1056199, 0.9243659,-1.3601631, 1.1842307,-1.6299537, 1.4756334,-1.9023752, 1.6572317,-2.003249, 1.669321,-1.893473, 1.8840985,-2.0063612, 2.1213202,-2.1213202, 2.1869059,-2.0536413, 2.2503333,-1.9839356, 2.3115396,-1.912272, 2.2131321,-1.7166812, 2.3906639,-1.7369189, 2.0770426,-1.4115567, 2.2302797,-1.4153785, 2.4940982,-1.4750056, 2.62892,-1.445261, 2.23299,-1.1377653, 2.5385184,-1.1945361, 2.4313858,-1.0521545, 2.686942,-1.0638356, 2.8226423,-1.0162138, 2.6503394,-0.86114746, 2.6646125,-0.77414155, 2.1942327,-0.56338316, 1.7811928,-0.39814374, 1.9936028,-0.38030007, 1.5980223,-0.2531019, 1.77933,-0.22478165, 1.192731,-0.112746276, 1.358207,-0.08545114, 1.7209803,-0.054083984]],
  },
  {
    name: 'Kzer-Za Dreadnought',
    description: 'The Ur-Quan Kzer-Za starship outline — 208 vertices of detailed spaceship geometry.',
    contours: [[101.25,1006.8145, 0,869.6563, 0.0128,630.5782, 0.0256,391.5, 13.7628,385.7424, 20.536,382.9626, 26.8712,380.4928, 32.8641,378.3054, 38.6107,376.3728, 44.2066,374.6673, 49.7478,373.1613, 55.3299,371.8271, 61.0488,370.6372, 67.0003,369.564, 73.2803,368.5797, 77.5213,368.0746, 82.5785,367.6654, 88.2632,367.3539, 94.3869,367.1417, 100.7611,367.0308, 107.1972,367.0227, 113.5067,367.1193, 119.5009,367.3223, 124.9913,367.6334, 129.7894,368.0545, 136.7786,368.942, 143.9999,370.1039, 151.3793,371.5207, 158.8427,373.1727, 166.3159,375.0405, 173.725,377.1045, 180.9957,379.345, 188.0539,381.7425, 194.8257,384.2775, 201.2368,386.9303, 212.5,391.8398, 212.0876,550.4199, 211.6751,709, 274.002,709, 336.3288,709, 335.6652,636.25, 335.5574,623.9179, 335.4541,611.092, 335.3569,598.0163, 335.267,584.935, 335.186,572.0922, 335.1154,559.732, 335.0566,548.0986, 335.0111,537.436, 334.9804,527.9884, 334.9659,520, 334.9303,476.5, 264.0222,418, 193.114,359.5, 193.057,295.4984, 193,231.4968, 308.7516,115.7484, 424.5032,0, 430.7139,0, 436.9246,0, 458.9753,20, 481.0259,40, 558.3853,40, 635.7447,40, 660.5012,19.9588, 685.2578,-0.0824, 692.0471,0.2088, 698.8365,0.5, 809.4255,115.9161, 920.0146,231.3321, 919.7573,295.3526, 919.5,359.3731, 850.3179,416.4366, 781.1359,473.5, 781.0679,593.7577, 781,714.0154, 842.25,713.7577, 903.5,713.5, 903.5,552.5, 903.5,391.5, 915.5,386.2894, 925.0132,382.3439, 934.2958,378.8801, 943.4206,375.8827, 952.4605,373.3363, 961.4884,371.2257, 970.5772,369.5356, 979.7999,368.2507, 989.2293,367.3557, 998.9384,366.8354, 1009,366.6743, 1018.876,366.8794, 1028.7419,367.4649, 1038.5688,368.4253, 1048.3277,369.7549, 1057.9897,371.448, 1067.5259,373.499, 1076.9074,375.9022, 1086.1052,378.6521, 1095.0904,381.7429, 1103.834,385.169, 1105.4327,385.8354, 1107.0215,386.4969, 1108.5745,387.1429, 1110.0655,387.7624, 1111.4684,388.3447, 1112.7573,388.879, 1113.9059,389.3544, 1114.8883,389.7601, 1115.6784,390.0853, 1116.25,390.3193, 1119,391.4385, 1118.9578,633.4692, 1118.9155,875.5, 1016.0895,1009.5, 913.2634,1143.5, 908.6317,1143.8048, 904,1144.1096, 904,993.0548, 904,842, 842.5,842, 781,842, 781,918.5, 781,995, 758.5,995, 753.2091,995.0074, 748.7946,995.0327, 745.1813,995.0811, 742.294,995.1573, 740.0573,995.2664, 738.396,995.4133, 737.2349,995.6029, 736.4987,995.8401, 736.1121,996.13, 736,996.4774, 736.0975,996.8214, 736.4274,997.1133, 737.0461,997.3587, 738.0101,997.5629, 739.3756,997.7314, 741.1991,997.8696, 743.5368,997.9828, 746.4451,998.0766, 749.9804,998.1563, 754.1991,998.2274, 772.3983,998.5, 823.7285,1071, 875.0586,1143.5, 558.8642,1143.7516, 507.7462,1143.787, 459.1795,1143.8106, 413.8289,1143.8226, 372.3594,1143.8232, 335.4356,1143.813, 303.7226,1143.792, 277.885,1143.7606, 258.5879,1143.7192, 246.4959,1143.668, 242.2739,1143.6073, 244.9583,1139.4844, 252.4121,1128.4439, 263.46,1112.2019, 276.9266,1092.4741, 291.6365,1070.9766, 306.4143,1049.4252, 320.0847,1029.536, 331.4722,1013.0247, 339.4015,1001.6074, 342.6973,997, 342.9826,996.9147, 343.6619,996.8251, 344.7008,996.7328, 346.0645,996.6396, 347.7187,996.5473, 349.6288,996.4577, 351.7603,996.3725, 354.0786,996.2935, 356.5492,996.2225, 359.1377,996.1611, 363.0447,996.0717, 366.2623,995.9793, 368.8541,995.8758, 370.8832,995.7532, 372.4132,995.6032, 373.5073,995.4179, 374.229,995.1892, 374.6416,994.9088, 374.8086,994.5689, 374.7933,994.1611, 374.6362,993.7568, 374.2833,993.4194, 373.6581,993.1416, 372.6841,992.9157, 371.285,992.7342, 369.3843,992.5896, 366.9056,992.4743, 363.7725,992.3806, 359.9084,992.3012, 355.2371,992.2284, 336,991.9568, 336,914.9784, 336,838, 274,838, 212,838, 212,991, 212,1144, 207.25,1143.9864, 202.5,1143.9727]],
  },
];

export function init(container: HTMLElement): void {
  container.innerHTML = `
    <div class="demo-page">
      <h2 class="demo-title">Shape Gallery</h2>
      <p class="demo-description">
        Real-world polygon datasets from the poly2tri, tess2.js, and SGI GLU tessellation test suites.
        These range from simple geometric shapes to complex figures with hundreds of vertices.
      </p>
      <div class="controls" style="margin-bottom:16px">
        <div class="control-group">
          <label>Shape:</label>
          <select id="shape-sel">
            ${SHAPES.map((s, i) => `<option value="${i}">${s.name}</option>`).join('')}
          </select>
        </div>
        <div class="control-group">
          <label>Winding rule:</label>
          <select id="winding-sel">
            ${WINDING_RULES.map((r, i) => `<option value="${i}"${r === 'Positive' ? ' selected' : ''}>${r}</option>`).join('')}
          </select>
        </div>
        <div class="control-group">
          <label><input type="checkbox" id="show-input" checked> Show input contour</label>
        </div>
        <div class="control-group">
          <label><input type="checkbox" id="show-wire" checked> Wireframe</label>
        </div>
      </div>
      <div id="canvas-area" style="display:flex;justify-content:center"></div>
      <div class="stats-bar" id="stats"></div>
      <div class="info-box" id="info-box"></div>
    </div>`;

  const canvasArea = container.querySelector('#canvas-area')!;
  const shapeSel = container.querySelector('#shape-sel') as HTMLSelectElement;
  const windingSel = container.querySelector('#winding-sel') as HTMLSelectElement;
  const showInputCb = container.querySelector('#show-input') as HTMLInputElement;
  const showWireCb = container.querySelector('#show-wire') as HTMLInputElement;
  const statsEl = container.querySelector('#stats')!;
  const infoEl = container.querySelector('#info-box')!;
  const canvas = makeCanvas(480, 480);
  canvasArea.appendChild(canvas);

  function render() {
    const shape = SHAPES[parseInt(shapeSel.value)];
    const wr = WINDING_RULES[parseInt(windingSel.value)] as WindingRule;

    const contours = shape.contours.map((verts, i) => ({
      vertices: verts,
      reversed: shape.reversed?.[i] ?? false,
    }));

    const t0 = performance.now();
    const result = tessellate(contours, wr);
    const elapsed = performance.now() - t0;

    if (result && result.elementCount > 0) {
      drawTessellation(canvas, result.vertices, result.elements, {
        fillColor: COLORS.fill,
        wireframe: showWireCb.checked,
        showInput: showInputCb.checked,
        inputContours: shape.contours,
      });
      const totalVerts = shape.contours.reduce((sum, c) => sum + c.length / 2, 0);
      statsEl.textContent = `${result.elementCount} triangles · ${result.vertexCount} output vertices · ${totalVerts} input vertices · ${elapsed.toFixed(2)}ms`;
    } else {
      const ctx = canvas.getContext('2d')!;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = '14px sans-serif';
      ctx.fillStyle = '#aaa';
      ctx.textAlign = 'center';
      ctx.fillText(result ? '(empty — 0 triangles)' : 'Tessellation failed', canvas.width / 2, canvas.height / 2);
      statsEl.textContent = result ? '0 triangles' : 'Tessellation failed';
    }

    infoEl.innerHTML = shape.description;
  }

  persistControls('shape_gallery', container);
  shapeSel.addEventListener('change', render);
  windingSel.addEventListener('change', render);
  showInputCb.addEventListener('change', render);
  showWireCb.addEventListener('change', render);
  render();
}
